# å®å¡”é¢æ¿éƒ¨ç½²æ•™ç¨‹

## ðŸŽ¯ éƒ¨ç½²æž¶æž„

- **å‰ç«¯**: å®å¡”é¢æ¿ç½‘ç«™ (ç«¯å£5221)
- **åŽç«¯**: Javaåº”ç”¨ (ç«¯å£8080)
- **æœåŠ¡å™¨IP**: 159.75.236.29

## ðŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. ç¡®ä¿å®å¡”é¢æ¿å·²å®‰è£…
```bash
# å¦‚æžœæœªå®‰è£…å®å¡”é¢æ¿ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
```

### 2. å®‰è£…å¿…è¦çš„è½¯ä»¶
åœ¨å®å¡”é¢æ¿ä¸­å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- **Nginx** (ç”¨äºŽå‰ç«¯ç½‘ç«™)
- **Javaé¡¹ç›®ç®¡ç†å™¨** æˆ– **PM2ç®¡ç†å™¨** (ç”¨äºŽåŽç«¯)
- **é˜²ç«å¢™** (ç«¯å£ç®¡ç†)

## ðŸŒ å‰ç«¯éƒ¨ç½² (ç«¯å£5221)

### æ­¥éª¤1: åˆ›å»ºç½‘ç«™

1. **ç™»å½•å®å¡”é¢æ¿**
   - è®¿é—®: `http://159.75.236.29:8888`
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

2. **æ·»åŠ ç«™ç‚¹**
   - ç‚¹å‡» `ç½‘ç«™` â†’ `æ·»åŠ ç«™ç‚¹`
   - **åŸŸå**: `159.75.236.29:5221`
   - **æ ¹ç›®å½•**: `/www/wwwroot/video-processor-frontend`
   - **PHPç‰ˆæœ¬**: çº¯é™æ€ (ä¸éœ€è¦PHP)
   - ç‚¹å‡» `æäº¤`

### æ­¥éª¤2: ä¸Šä¼ å‰ç«¯æ–‡ä»¶

1. **é€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨**
   - ç‚¹å‡» `æ–‡ä»¶`
   - è¿›å…¥ `/www/wwwroot/video-processor-frontend`
   - ä¸Šä¼  `Front` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š
     - `index.html`
     - `script.js`
     - `style.css`

2. **æˆ–é€šè¿‡FTP/SFTPä¸Šä¼ **
   ```bash
   scp -r Front/* root@159.75.236.29:/www/wwwroot/video-processor-frontend/
   ```

### æ­¥éª¤3: é…ç½®Nginx

1. **ç¼–è¾‘ç½‘ç«™é…ç½®**
   - åœ¨ç½‘ç«™åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšåˆ›å»ºçš„ç«™ç‚¹
   - ç‚¹å‡» `è®¾ç½®`
   - é€‰æ‹© `é…ç½®æ–‡ä»¶`

2. **ä¿®æ”¹Nginxé…ç½®**
   ```nginx
   server {
       listen 5221;
       server_name 159.75.236.29;
       index index.html;
       root /www/wwwroot/video-processor-frontend;
       
       # é™æ€æ–‡ä»¶å¤„ç†
       location / {
           try_files $uri $uri/ /index.html;
       }
       
       # é™æ€èµ„æºç¼“å­˜
       location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
           expires 1y;
           add_header Cache-Control "public, immutable";
       }
       
       # å®‰å…¨å¤´
       add_header X-Frame-Options "SAMEORIGIN" always;
       add_header X-Content-Type-Options "nosniff" always;
       add_header X-XSS-Protection "1; mode=block" always;
       
       # æ—¥å¿—æ–‡ä»¶
       access_log /www/wwwlogs/video-frontend.log;
       error_log /www/wwwlogs/video-frontend.error.log;
   }
   ```

3. **é‡è½½Nginxé…ç½®**
   - ç‚¹å‡» `ä¿å­˜`
   - åœ¨ `è½¯ä»¶å•†åº—` â†’ `Nginx` â†’ `é‡è½½é…ç½®`

### æ­¥éª¤4: å¼€æ”¾ç«¯å£

1. **åœ¨å®å¡”é¢æ¿ä¸­å¼€æ”¾ç«¯å£**
   - ç‚¹å‡» `å®‰å…¨`
   - æ·»åŠ ç«¯å£è§„åˆ™ï¼š
     - **ç«¯å£**: `5221`
     - **åè®®**: `TCP`
     - **ç­–ç•¥**: `æ”¾è¡Œ`
     - **å¤‡æ³¨**: `å‰ç«¯ç½‘ç«™ç«¯å£`

2. **æ£€æŸ¥ç³»ç»Ÿé˜²ç«å¢™**
   ```bash
   # å¦‚æžœä½¿ç”¨ufw
   sudo ufw allow 5221/tcp
   
   # å¦‚æžœä½¿ç”¨firewalld
   sudo firewall-cmd --permanent --add-port=5221/tcp
   sudo firewall-cmd --reload
   ```

## â˜• åŽç«¯éƒ¨ç½² (ç«¯å£8080)

### æ–¹æ¡ˆ1: ä½¿ç”¨å®å¡”Javaé¡¹ç›®ç®¡ç†å™¨ (æŽ¨è)

1. **å®‰è£…Javaé¡¹ç›®ç®¡ç†å™¨**
   - åœ¨ `è½¯ä»¶å•†åº—` ä¸­æœç´¢ `Javaé¡¹ç›®ç®¡ç†å™¨`
   - ç‚¹å‡»å®‰è£…

2. **ä¸Šä¼ JARæ–‡ä»¶**
   - é€šè¿‡æ–‡ä»¶ç®¡ç†å™¨ä¸Šä¼  `video-frame-extractor-1.0.0.jar` åˆ° `/www/server/java-project/`

3. **æ·»åŠ Javaé¡¹ç›®**
   - ç‚¹å‡» `Javaé¡¹ç›®ç®¡ç†å™¨`
   - ç‚¹å‡» `æ·»åŠ é¡¹ç›®`
   - **é¡¹ç›®åç§°**: `video-frame-extractor`
   - **é¡¹ç›®è·¯å¾„**: `/www/server/java-project/video-frame-extractor-1.0.0.jar`
   - **å¯åŠ¨ç«¯å£**: `8080`
   - **JVMå‚æ•°**: `-Xmx2g -Xms1g`
   - **å¯åŠ¨å‚æ•°**: `--spring.profiles.active=prod`
   - ç‚¹å‡» `æäº¤`

4. **å¯åŠ¨é¡¹ç›®**
   - åœ¨é¡¹ç›®åˆ—è¡¨ä¸­ç‚¹å‡» `å¯åŠ¨`
   - æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ

### æ–¹æ¡ˆ2: ä½¿ç”¨PM2ç®¡ç†å™¨

1. **å®‰è£…PM2ç®¡ç†å™¨**
   - åœ¨ `è½¯ä»¶å•†åº—` ä¸­å®‰è£… `PM2ç®¡ç†å™¨`

2. **åˆ›å»ºå¯åŠ¨è„šæœ¬**
   ```bash
   # åˆ›å»ºå¯åŠ¨è„šæœ¬
   cat > /www/server/java-project/start-backend.sh << 'EOF'
   #!/bin/bash
   cd /www/server/java-project
   java -Xmx2g -Xms1g -jar video-frame-extractor-1.0.0.jar --spring.profiles.active=prod
   EOF
   
   # è®¾ç½®æ‰§è¡Œæƒé™
   chmod +x /www/server/java-project/start-backend.sh
   ```

3. **åœ¨PM2ä¸­æ·»åŠ é¡¹ç›®**
   - ç‚¹å‡» `PM2ç®¡ç†å™¨`
   - ç‚¹å‡» `æ·»åŠ é¡¹ç›®`
   - **é¡¹ç›®åç§°**: `video-backend`
   - **å¯åŠ¨æ–‡ä»¶**: `/www/server/java-project/start-backend.sh`
   - **è¿è¡Œç›®å½•**: `/www/server/java-project`
   - ç‚¹å‡» `æäº¤`

### æ–¹æ¡ˆ3: æ‰‹åŠ¨éƒ¨ç½² (ç³»ç»ŸæœåŠ¡)

1. **ä¸Šä¼ JARæ–‡ä»¶**
   ```bash
   scp target/video-frame-extractor-1.0.0.jar root@159.75.236.29:/opt/video-processor/
   ```

2. **åˆ›å»ºç³»ç»ŸæœåŠ¡**
   ```bash
   # åˆ›å»ºæœåŠ¡æ–‡ä»¶
   sudo tee /etc/systemd/system/video-backend.service > /dev/null <<EOF
   [Unit]
   Description=Video Frame Extractor Backend
   After=network.target
   
   [Service]
   Type=simple
   User=root
   WorkingDirectory=/opt/video-processor
   ExecStart=/usr/bin/java -Xmx2g -Xms1g -jar video-frame-extractor-1.0.0.jar --spring.profiles.active=prod
   Restart=always
   RestartSec=10
   
   [Install]
   WantedBy=multi-user.target
   EOF
   
   # å¯åŠ¨æœåŠ¡
   sudo systemctl daemon-reload
   sudo systemctl enable video-backend
   sudo systemctl start video-backend
   ```

### å¼€æ”¾åŽç«¯ç«¯å£

1. **åœ¨å®å¡”é¢æ¿ä¸­å¼€æ”¾8080ç«¯å£**
   - ç‚¹å‡» `å®‰å…¨`
   - æ·»åŠ ç«¯å£è§„åˆ™ï¼š
     - **ç«¯å£**: `8080`
     - **åè®®**: `TCP`
     - **ç­–ç•¥**: `æ”¾è¡Œ`
     - **å¤‡æ³¨**: `åŽç«¯APIç«¯å£`

## ðŸ”§ ç”Ÿäº§çŽ¯å¢ƒé…ç½®

### 1. åˆ›å»ºç”Ÿäº§çŽ¯å¢ƒé…ç½®æ–‡ä»¶

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸­åˆ›å»º `/www/server/java-project/application-prod.yml`ï¼š

```yaml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  servlet:
    multipart:
      max-file-size: 1GB
      max-request-size: 1GB
  profiles:
    active: prod

logging:
  level:
    com.videoprocessor: INFO
    org.bytedeco: WARN
  file:
    name: /www/wwwlogs/video-backend.log
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

video:
  processor:
    temp-dir: /tmp/video-processor
    max-duration: 7200
    supported-formats: mp4,avi,mov,mkv,wmv,flv,webm
```

### 2. SSLè¯ä¹¦é…ç½® (å¯é€‰)

1. **ç”³è¯·SSLè¯ä¹¦**
   - åœ¨å®å¡”é¢æ¿ä¸­ç‚¹å‡»ç½‘ç«™ `è®¾ç½®`
   - é€‰æ‹© `SSL`
   - é€‰æ‹© `Let's Encrypt` æˆ–ä¸Šä¼ è‡ªæœ‰è¯ä¹¦

2. **å¼ºåˆ¶HTTPS**
   - å¼€å¯ `å¼ºåˆ¶HTTPS`
   - æ›´æ–°å‰ç«¯APIåœ°å€ä¸ºHTTPS

### 3. åŸŸåé…ç½® (å¯é€‰)

å¦‚æžœæœ‰åŸŸåï¼Œå¯ä»¥é…ç½®åŸŸåè®¿é—®ï¼š

1. **æ·»åŠ åŸŸåè§£æž**
   - åœ¨åŸŸåæœåŠ¡å•†å¤„æ·»åŠ Aè®°å½•æŒ‡å‘ `159.75.236.29`

2. **ä¿®æ”¹ç½‘ç«™é…ç½®**
   - å°†ç½‘ç«™åŸŸåæ”¹ä¸ºå®žé™…åŸŸå
   - æ›´æ–°å‰ç«¯APIåœ°å€

## ðŸ“Š ç›‘æŽ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹ç½‘ç«™çŠ¶æ€

- **ç½‘ç«™è®¿é—®æ—¥å¿—**: `/www/wwwlogs/video-frontend.log`
- **ç½‘ç«™é”™è¯¯æ—¥å¿—**: `/www/wwwlogs/video-frontend.error.log`
- **åŽç«¯åº”ç”¨æ—¥å¿—**: `/www/wwwlogs/video-backend.log`

### 2. æ€§èƒ½ç›‘æŽ§

1. **åœ¨å®å¡”é¢æ¿ä¸­æŸ¥çœ‹**
   - `ç›‘æŽ§` â†’ `ç³»ç»ŸçŠ¶æ€`
   - æŸ¥çœ‹CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

2. **Javaåº”ç”¨ç›‘æŽ§**
   - åœ¨ `Javaé¡¹ç›®ç®¡ç†å™¨` ä¸­æŸ¥çœ‹åº”ç”¨çŠ¶æ€
   - æŸ¥çœ‹å†…å­˜ä½¿ç”¨å’ŒGCæƒ…å†µ

### 3. å®šæœŸç»´æŠ¤

```bash
# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
sudo rm -rf /tmp/video-processor/*

# æ¸…ç†æ—¥å¿—æ–‡ä»¶ (ä¿ç•™æœ€è¿‘7å¤©)
find /www/wwwlogs -name "*.log" -mtime +7 -delete

# é‡å¯æœåŠ¡ (å¦‚æžœéœ€è¦)
sudo systemctl restart video-backend
```

## ðŸ” æ•…éšœæŽ’æŸ¥

### 1. å‰ç«¯æ— æ³•è®¿é—®

1. **æ£€æŸ¥NginxçŠ¶æ€**
   - åœ¨å®å¡”é¢æ¿ `è½¯ä»¶å•†åº—` â†’ `Nginx` â†’ æŸ¥çœ‹çŠ¶æ€

2. **æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾**
   ```bash
   netstat -tlnp | grep 5221
   ```

3. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**
   ```bash
   tail -f /www/wwwlogs/video-frontend.error.log
   ```

### 2. åŽç«¯APIæ— æ³•è®¿é—®

1. **æ£€æŸ¥Javaåº”ç”¨çŠ¶æ€**
   - åœ¨ `Javaé¡¹ç›®ç®¡ç†å™¨` ä¸­æŸ¥çœ‹åº”ç”¨çŠ¶æ€

2. **æ£€æŸ¥ç«¯å£ç›‘å¬**
   ```bash
   netstat -tlnp | grep 8080
   ```

3. **æŸ¥çœ‹åº”ç”¨æ—¥å¿—**
   ```bash
   tail -f /www/wwwlogs/video-backend.log
   ```

### 3. è·¨åŸŸé—®é¢˜

å¦‚æžœå‡ºçŽ°è·¨åŸŸé”™è¯¯ï¼Œæ£€æŸ¥ï¼š
1. åŽç«¯CORSé…ç½®æ˜¯å¦æ­£ç¡®
2. å‰ç«¯APIåœ°å€æ˜¯å¦æ­£ç¡®
3. ç«¯å£æ˜¯å¦åŒ¹é…

## âœ… éƒ¨ç½²éªŒè¯

### 1. æµ‹è¯•å‰ç«¯è®¿é—®
```bash
curl http://159.75.236.29:5221
```

### 2. æµ‹è¯•åŽç«¯API
```bash
curl http://159.75.236.29:8080/api/video/health
```

### 3. æµ‹è¯•å®Œæ•´åŠŸèƒ½
1. åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://159.75.236.29:5221`
2. ç‚¹å‡» `æ£€æŸ¥æœåŠ¡çŠ¶æ€` æŒ‰é’®
3. ä¸Šä¼ è§†é¢‘æ–‡ä»¶æµ‹è¯•åŠŸèƒ½

## ðŸŽ¯ è®¿é—®åœ°å€æ€»ç»“

- **å‰ç«¯ç½‘ç«™**: http://159.75.236.29:5221
- **åŽç«¯API**: http://159.75.236.29:8080/api
- **å®å¡”é¢æ¿**: http://159.75.236.29:8888
- **å¥åº·æ£€æŸ¥**: http://159.75.236.29:8080/api/video/health

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½é‡è¦æ•°æ®**: å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œæ•°æ®
2. **å®‰å…¨è®¾ç½®**: ä¿®æ”¹å®å¡”é¢æ¿é»˜è®¤ç«¯å£å’Œå¯†ç 
3. **é˜²ç«å¢™é…ç½®**: åªå¼€æ”¾å¿…è¦çš„ç«¯å£
4. **SSLè¯ä¹¦**: ç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä½¿ç”¨HTTPS
5. **ç›‘æŽ§å‘Šè­¦**: é…ç½®æœåŠ¡å¼‚å¸¸å‘Šè­¦
6. **å®šæœŸæ›´æ–°**: ä¿æŒç³»ç»Ÿå’Œè½¯ä»¶ç‰ˆæœ¬æ›´æ–°

## ðŸš€ ä¼˜åŒ–å»ºè®®

1. **CDNåŠ é€Ÿ**: å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°CDN
2. **è´Ÿè½½å‡è¡¡**: é«˜å¹¶å‘æ—¶ä½¿ç”¨è´Ÿè½½å‡è¡¡
3. **æ•°æ®åº“**: å¦‚éœ€æŒä¹…åŒ–å­˜å‚¨å¯æ·»åŠ æ•°æ®åº“
4. **ç¼“å­˜**: ä½¿ç”¨Redisç¼“å­˜æé«˜æ€§èƒ½
5. **å®¹å™¨åŒ–**: è€ƒè™‘ä½¿ç”¨Dockeréƒ¨ç½²